---
title: Access user IDs in RLS policies
description: Learn how to access Clerk user IDs in your Supabase RLS policies.
---

# Access user IDs in RLS policies

To add user-specific features to your app, such as a profile page, your Supabase tables need Row Level Security policies [(RLS)](https://supabase.com/docs/guides/auth/row-level-security) that allow users to access only the content associated with their accounts.

Supabase's `auth.uid()` enables you to do this, but is not compatible with Clerk user accounts. Follow the steps below to learn how to associate Clerk user IDs with content in your Supabase database tables.

<Steps>

### Create a Supabase JWT template

To get started, you must add a Supabase JWT template to your Clerk project. See [the Supabase Quickstart](/docs/integrations/databases/supabase/quickstart#create-a-supabase-jwt-template) to learn how.

### Add `user_id` to your Supabase tables

You must add a column for user IDs to the relevant tables in your database:
- In your Supabase dashboard, in the sidebar, navigate to **Database** > **Tables**. From here, you can choose which table you want to edit, and add new rows.
    - For this example, you can call the row `user_id`.
    - **This column's data type must be `text`**.

### Create a SQL query that checks the user ID

Next, you must create a `requesting_user_id()` function so you can access the user ID in your RLS policies:
    1. In your Supabase dashboard, in the sidebar, navigate to **SQL Editor**, then select **New query**. Paste the following into the editor:
        ```sql
        create or replace function requesting_user_id() returns text as $$ select nullif(current_setting('request.jwt.claims', true)::json->>'sub', '')::text; $$ language sql stable;
        ```
    1. Select **Run** to execute the query and create the function.

### Create ID-based RLS policies

Now you must create RLS policies that allow users to modify and read content associated with their user IDs:
1. Create an RLS policy for inserting content:
    - In your Supabase dashboard, in the sidebar, navigate to **Authentication** > **Policies**. Under the name of the table you want users to have access to, select **New Policy**.
    - If you're using the policy editor, paste the following snippet:
        ```sql filename="Supabase policy editor"
        CREATE POLICY "create user post" ON "public"."Posts"
        AS PERMISSIVE FOR INSERT
        TO authenticated

        WITH CHECK (requesting_user_id() = user_id)
        ```       
    - If you're using the GUI to create a policy, select **For full customization**.
        - Name the policy whatever you want.
        - For **Allowed operation**, select **INSERT**.
        - For **Target roles**, select **authenticated**.
        - For the **USING** expression, paste the following:
        ```sql filename="Supabase policy editor"
        requesting_user_id() = user_id
        ```
        <Callout type="info">
        Replace `user_id` with whatever you named the column you'll be storing user IDs in.
        </Callout>
1. Create another RLS policy to allow users to read content from the same table they can modify. Follow the same instructions as the previous step, but for **Allowed operation**, select **SELECT** instead of **INSERT**.
    - If you're using the editor, copy the same snippet from the previous step, replacing `FOR INSERT` with `FOR SELECT`.

### Fetch and modify your content from code

Now you can create and read content from your tables based on the user ID. The following example demonstrates a component that allows you to create and read posts from Supabase with authentication by Clerk:
<CodeBlockTabs type="framework" options={["Next.js App Router", "Next.js Pages Router", "React"]}>
```ts filename="app/supabase-posts/page.tsx"
"use client";
import { useAuth } from "@clerk/clerk-react";
import { createClient } from "@supabase/supabase-js";
import { useRef, useState } from "react";

// Returns a client object that 
const supabaseClient = async (supabaseAccessToken: string | null) => {
  return createClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL ?? "",
    process.env.NEXT_PUBLIC_SUPABASE_KEY ?? "",
    {
      global: { 
        headers: { 
          // Adds the access token generated by your Supabase
          // JWT template to the client object,
          Authorization: `Bearer ${supabaseAccessToken}` 
        } 
      },
    }
  );
};

export default function SupabasePosts() {
  const { getToken, userId } = useAuth();

  const getSupabaseClient = async () => {
    // Replace with your JWT template name
    const supabaseAccessToken = await getToken({ template: "supabase" });
    return await supabaseClient(supabaseAccessToken);
  };

  const [posts, setPosts] = useState<any>(null);
  const getPosts = async () => {
    const client = await getSupabaseClient();
    // Fetches all posts scoped to the user
    // Replace "Posts" with your table name
    const { data, error } = await client.from("Posts").select();
    setPosts(error || data);
  };

  const inputRef = useRef<HTMLInputElement>(null);
  const sendPost = async () => {
    if (!inputRef.current?.value) return;
    const client = await getSupabaseClient();
    const { data, error } = await client.from("Posts").insert({
      user_id: userId,
      content: inputRef.current?.value,
    });
  };

  return (
    <>
      <div style={{ display: "flex", flexDirection: "column" }}>
        <input style={{ color: "black" }} type="text" ref={inputRef} />
        <button onClick={sendPost}>Send Post</button>
        <button onClick={getPosts}>Fetch Posts</button>
      </div>
      <h2>Posts</h2>
      <p>
        {!posts ? (
          <strong>No posts</strong>
        ) : (
          <ul>
            {posts.map((post: any) => (
              <li key={post.id}>{post.content}</li>
            ))}
          </ul>
        )}
      </p>
    </>
  );
}
```
```ts filename="pages/supabase-posts/index.tsx"
import { useAuth } from "@clerk/clerk-react";
import { createClient } from "@supabase/supabase-js";
import { useRef, useState } from "react";

const supabaseClient = async (supabaseAccessToken: string | null) => {
  const supabase = createClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL ?? "",
    process.env.NEXT_PUBLIC_SUPABASE_KEY ?? "",
    {
      global: { 
        headers: { 
          // Adds the access token generated by your Supabase
          // JWT template to the client object,
          Authorization: `Bearer ${supabaseAccessToken}` 
        } 
      },
    }
  );
  // set Supabase JWT on the client object,
  // so it is sent up with all Supabase requests
  return supabase;
};

export default function SupabasePosts() {
  const { getToken, userId } = useAuth();

  const getSupabaseClient = async () => {
    // Replace with your JWT template name
    const supabaseAccessToken = await getToken({ template: "supabase" });
    return await supabaseClient(supabaseAccessToken);
  };

  const [posts, setPosts] = useState<any>(null);
  const getPosts = async () => {
    const client = await getSupabaseClient();
    // Fetches all posts scoped to the user
    // Replace "Posts" with your table name
    const { data, error } = await client.from("Posts").select();
    setPosts(error || data);
  };

  const inputRef = useRef<HTMLInputElement>(null);
  const sendPost = async () => {
    if (!inputRef.current?.value) return;
    const client = await getSupabaseClient();
    const { data, error } = await client.from("Posts").insert({
      user_id: userId,
      content: inputRef.current?.value,
    });
  };

  return (
    <>
      <div style={{ display: "flex", flexDirection: "column" }}>
        <input style={{ color: "black" }} type="text" ref={inputRef} />
        <button onClick={sendPost}>Send Post</button>
        <button onClick={getPosts}>Fetch Posts</button>
      </div>
      <h2>Posts</h2>
      <p>
        {!posts ? (
          <strong>No posts</strong>
        ) : (
          <ul>
            {posts.map((post: any) => (
              <li key={post.id}>{post.content}</li>
            ))}
          </ul>
        )}
      </p>
    </>
  );
}
```
```ts filename="components/supabase-posts.tsx"
import { useAuth } from "@clerk/clerk-react";
import { createClient } from "@supabase/supabase-js";
import { useRef, useState } from "react";

const supabaseClient = async (supabaseAccessToken: string | null) => {
  const supabase = createClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL ?? "",
    process.env.NEXT_PUBLIC_SUPABASE_KEY ?? "",
    {
      global: { 
        headers: { 
          // Adds the access token generated by your Supabase
          // JWT template to the client object,
          Authorization: `Bearer ${supabaseAccessToken}` 
        } 
      },
    }
  );
  // set Supabase JWT on the client object,
  // so it is sent up with all Supabase requests
  return supabase;
};

export default function SupabasePosts() {
  const { getToken, userId } = useAuth();

  const getSupabaseClient = async () => {
    // Replace with your JWT template name
    const supabaseAccessToken = await getToken({ template: "supabase" });
    return await supabaseClient(supabaseAccessToken);
  };

  const [posts, setPosts] = useState<any>(null);
  const getPosts = async () => {
    const client = await getSupabaseClient();
    // Fetches all posts scoped to the user
    // Replace "Posts" with your table name
    const { data, error } = await client.from("Posts").select();
    setPosts(error || data);
  };

  const inputRef = useRef<HTMLInputElement>(null);
  const sendPost = async () => {
    if (!inputRef.current?.value) return;
    const client = await getSupabaseClient();
    const { data, error } = await client.from("Posts").insert({
      user_id: userId,
      content: inputRef.current?.value,
    });
  };

  return (
    <>
      <div style={{ display: "flex", flexDirection: "column" }}>
        <input style={{ color: "black" }} type="text" ref={inputRef} />
        <button onClick={sendPost}>Send Post</button>
        <button onClick={getPosts}>Fetch Posts</button>
      </div>
      <h2>Posts</h2>
      <p>
        {!posts ? (
          <strong>No posts</strong>
        ) : (
          <ul>
            {posts.map((post: any) => (
              <li key={post.id}>{post.content}</li>
            ))}
          </ul>
        )}
      </p>
    </>
  );
}
```
</CodeBlockTabs>
</Steps>
